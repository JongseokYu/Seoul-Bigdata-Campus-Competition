---
title: "distance"
author: "JINHYEOK, KIM"
date: "2022-11-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("C:/R_Program_Files/R_Working_Directory/PSAT/charging_station/final_final")
```

## library

```{r, message=F}
library(dplyr)
library(tidyverse)
library(caret)
library(data.table)
library(plyr)
library(ggplot2)
library(stats)
library(MASS)
library(factoextra)
library(magrittr)
library(data.table)
library(tidyverse)
library(geosphere)
```

## 각 행정동 내 주유소 별 충전소까지의 거리

```{r}
echarge <- read.csv("echarge_total_lim.csv", header=T, fileEncoding = "cp949")
oil <- read.csv("seoul_oil_sinsa.csv", header=T, fileEncoding = "cp949")
```

```{r}
### 편의상 행정동 변수 이름은 gangnam으로 통일
gangnam_echarge <- echarge %>% filter(행정동 == '여의동')
gangnam_echarge <- gangnam_echarge[,c(9,10)]
gangnam_oil <- oil %>% filter(행정동 == '여의동')

colnames(gangnam_echarge) <- c('long','lat')
gangnam_echarge$long <- gangnam_echarge$long %>% as.numeric
gangnam_echarge$lat <- gangnam_echarge$lat %>% as.numeric

### 주유소 별 충전소까지의 거리
dist_gangnam <- matrix(nrow = nrow(gangnam_oil), ncol = nrow(gangnam_echarge))
for (i in 1:nrow(gangnam_oil)) {
  lon1 <- gangnam_oil$경도[i]
  lat1 <- gangnam_oil$위도[i]
  for (j in 1:nrow(gangnam_echarge)) {
    lon2 <- gangnam_echarge$long[j]
    lat2 <- gangnam_echarge$lat[j]
    
    dist_gangnam[i,j] <-  distHaversine(c(lon1, lat1), c(lon2, lat2))
  }
  if (i %% 10 == 0) {
    print(i)
  }
}

dist_gangnam <- dist_gangnam %>% as.data.frame()
dist_gangnam$idx <- 1:nrow(dist_gangnam)
```

```{r}
###각 주유소 별 가장 가까운 전기차 충전소까지의 거리

apply(dist_gangnam[,-length(dist_gangnam)], 1, FUN = min, na.rm = TRUE)
```
